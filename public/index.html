<!DOCTYPE html>
<html>
<head>
  <title>Address Lookup</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    #container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    .input-group {
        display: flex;
        align-items: center;
    }

    input[type="text"] {
      flex: 1;
      width: 96%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-bottom: 20px;
    }

    #submitButton {
        margin-left: 10px;
        margin-bottom: 20px;
        padding: 5px;
        align-self: flex-end;
    }

    #result {
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 5px;
      margin-top: 20px;
      background-color: #f9f9f9;
    }

    #result p {
      margin: 0;
      margin-bottom: 10px;
    }

    #municipal_type {
      font-weight: bold;
      font-size: 20px;
      margin-bottom: 20px;
    }

    .default-button {
      background-color: #787474;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .green-button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .red-button {
      background-color: #FF5733;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .blue-button {
      background-color: #007BFF;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: none; /* Initially hidden */
    }

    .spinner {
      position: relative;
      top: 2px;
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-top: 4px solid #333;
      border-radius: 50%;
      width: 12px;
      height: 12px;
      animation: spin 2s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

  </style>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBZGoN5IxgQlg5ECqEEbjkf_sfJptW5QD4&libraries=places"></script>

</head>
<body>
  <div id="container">
    <label for="addressInput">Enter Address:</label>
    <div class="input-group">
        <input type="text" id="addressInput" placeholder="2600 16th St, Sacramento, CA">
        
        <input type="hidden" id="cityInput" name="cityInput" />
        <input type="hidden" id="zipcodeInput" name="zipcodeInput" />
        <input type="hidden" id="stateInput" name="stateInput" />

        <button id="submitButton" class="default-button">
            <span id="spinner" class="spinner" style="display: none;"></span>
            Submit Address
        </button>
    </div>
    <div id="result" style="display: none;"></div>

    <!-- New Button -->
    <button id="sendToAirtableButton" class="blue-button">
      Send to Airtable â–º
    </button>

</div>

  <script>
    const addressInput = document.getElementById("addressInput");
    const resultDiv = document.getElementById("result");
    const submitButton = document.getElementById("submitButton");
    const sendToAirtableButton = document.getElementById("sendToAirtableButton"); // New button

    submitButton.addEventListener("click", fetchData);

    async function fetchData() {
      const address = addressInput.value.trim();
      const city = document.getElementById("cityInput").value;
      const zipcode = document.getElementById("zipcodeInput").value;
      const state = document.getElementById("stateInput").value;

      if (address !== "") {
        submitButton.disabled = true;

        try {
          document.getElementById("spinner").style.display = "inline-block";
        } catch (error) {
          let sub_btn = document.getElementById("submitButton");
          sub_btn.classList.remove("default-button", "green-button", "red-button");
          sub_btn.classList.add("default-button");
          sub_btn.innerHTML = '<span id="spinner" class="spinner" style="display: none;"></span> Submit Address';
          document.getElementById("spinner").style.display = "inline-block";
        }

        const dataToSend = {
          address,
          city,
          zipcode,
          state,
        };

        try {
          const response = await fetch("/get_data", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ dataToSend }),
          });

          const all_data = await response.json();

          submitButton.disabled = false;
          document.getElementById("spinner").style.display = "none";

          showData(all_data);

          // Show the new button
          sendToAirtableButton.style.display = "block";

        } catch (error) {
          submitButton.disabled = false;
          document.getElementById("spinner").style.display = "none";
          console.error(error);
          showData({ error: "Something went wrong" });
        }
      } else {
        resultDiv.style.display = "block";
        resultDiv.innerHTML = '<p style="color: red;">Please enter an address</p>';
      }
    }

    // Event listener for the new button
    sendToAirtableButton.addEventListener("click", async () => {
      try {
        sendToAirtableButton.disabled = true;
        sendToAirtableButton.style.backgroundColor = "#d3d3d3"; // Light grey

        const dataToSend = {
          address: addressInput.value.trim(),
          city: document.getElementById("cityInput").value,
          zipcode: document.getElementById("zipcodeInput").value,
          state: document.getElementById("stateInput").value,
        };

        await fetch("https://hooks.zapier.com/hooks/catch/13783267/24ede1p/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(dataToSend),
        });

      } catch (error) {
        console.error("Error sending data to Airtable:", error);
      }
    });

    function showData(all_data) {
      // existing showData logic...
      // No changes required here
    }

    function initAutocomplete() {
      const addressInput = document.getElementById("addressInput");
      const autocomplete = new google.maps.places.Autocomplete(addressInput);

      autocomplete.addListener("place_changed", function () {
        const place = autocomplete.getPlace();
        if (!place.geometry) {
          console.error("Place details not found for the input.");
          return;
        }

        const city = place.address_components.find(
          (component) => component.types.includes("locality")
        );
        const zipcode = place.address_components.find(
          (component) => component.types.includes("postal_code")
        );
        const state = place.address_components.find(
          (component) => component.types.includes("administrative_area_level_1")
        );

        document.getElementById("cityInput").value = city ? city.long_name : "";
        document.getElementById("zipcodeInput").value = zipcode ? zipcode.long_name : "";
        document.getElementById("stateInput").value = state ? state.short_name : "";
      });
    }

    google.maps.event.addDomListener(window, "load", initAutocomplete);
  </script>

</body>
</html>
